# 코루틴
파이썬의 동시성을 찾아보면 코루틴을 접하게 된다. 이 때, 동시성은 병렬성과는 다른 의미이다. 병렬성은 '실제로 동시'에 A, B, C가 동작하는 것이고 동시성은 A, B, C를 번갈아가며 '동시처럼 보이게' 동작하는 것이다.
코루틴은 동시성을 지원하지만 병렬성을 지원하지 않는다.

코루틴은 실행의 지연과 재개를 허용함으로써, 비선점적 멀티태스킹을 위한 서브 루틴을 일반화한 컴퓨터 프로그램 구성요소라고 정의된다.
* 비선점형 : 하나의 프로세스가 CPU를 할당받으면 종료되기 전까지 다른 프로세스가 CPU를 강제로 차지할 수 없습니다. (코루틴)
* 선점형 : 하나의 프로세스가 다른 프로세스 대신에 프로세서(CPU)를 강제로 차지할 수 있습니다. (쓰레드)

프로그램은 여러 루틴의 조합으로 진행되는데, 보통 메인 루틴과 서브 루틴으로 나뉜다.
* 메인 루틴 : 프로그램 전체의 개괄적인 동작으로 main 함수에 의해 수행되는 흐름
* 서브 루틴 : 반복적인 기능을 모은 동작으로 main 함수 내에서 실행되는 개별 함수의 흐름

이런 메인루틴과 서브루틴의 흐름은 메인루틴이 서브루틴을 호출하는 처리를 완료하면 서브루틴은 종료되고 메인루틴이 마저 수행된다. 이것이 일반적인 흐름이다. 코루틴은 서브 루틴과 비슷하지만 차이점이 있다.

서브 루틴은 단일 진입 지점에서 시작 후 단일 반환 지점에서 종료되는 것에 반해, 코루틴은 진입 후 반환문이 없더라도 임의 지점에서 실행 중 동작을 중단하고 이후 해당 지점에서부터 실행을 재개한다. 즉, 진입과 반환이 여러 개이다.

코루틴들은 완전히 대칭적인, 즉 서로가 서로를 호출하는 관계이다. 코루틴은 실행후 종료되는 것이 아니라 실행후 대기한다.

코루틴은 멀티쓰레드를 대체하기 위한 것이 아니며, 대기하는 작업을 기다리는 동안 다른 작업을 먼저 처리함으로써 CPU의 유휴 시간(Idle time)을 최소화하기 위한 것이다.

스레드는 프로세스 내에서 실행되는 흐름의 단위를 말한다. 그리고 코루틴은 (일시) 정지 가능한 함수로써, 기본적으로 하나의 스레드를 가진다. 따라서 직접적인 관계는 없다.

코루틴과 스레드를 더 살펴보자면 코루틴을 일종의 경량 스레드로 보는 시각도 있다. 코루틴은 비동기로 동작하지만 다른 스레드로 분리되지 않는다. 

A, B, C를 동시에 처리할때 각각 다른 스레드로 분리되면 스레드를 전환할 때마다 소모되는 시간이 있다. 이 스레드 전환을 컨텍스트 스위치라고 하고, 소모되는 시간을 컨텍스트 스위치 비용이라 표현한다(프로세스 간 전환도 컨텍스트 스위치라고 하고 이게 가장 무겁다).

하지만 코루틴은 같은 스레드에서 동시(동시성)에 처리되기 때문에 컨텍스트 스위치 비용이 발생하지 않는다.
