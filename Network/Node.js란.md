# Node.js

### Node.js란?
Node.js는 자바스크립트를 브라우저를 통하지 않고도 사용할 수 있게 해주는 런타임이다. HTTP가 내장되어 있기 때문에 보통 server로 사용하는 경우가 많다.   
하지만 응용프로그램을 실행하는데 쓸 수 도 있다. 웹팩, 바벨과 같은 도구들이 모두 Node.js를 기반으로 돌아간다.   

### Node.js는 싱글스레드 인가?

Node.Js는 싱글스레드이다. 싱글스레드란 프로세스 내에서 한개의 스레드가 하나의 요청만을 수행한다.   
이렇게 하나의 요청을 수행할 때 다른 요청을 막는 것을 블로킹 모델이라 한다. 그러나 노드js는 싱글스레드임에도 논블로킹 모델이다.   
비동기 I/O 작업을 통해 많은 요청들을 비동기로 수행함으로 서로 블로킹하지 않는다. 이 점이 Node.Js의 특이한 점이다.   

하지만 완전한 싱글스레드라고 할 수는 없다. 일부 블로킹 작업들은libuv의 스레드풀에서 실행된다. 이를 제대로 알기 위해선 Node.Js가 동작하는 구조를 알아야 한다.   

### Node.js는 어떻게 동작하는가?
Node.Js는 이벤트 기반으로 동작하고, 이벤트 기반이란 이벤트가 발생할 때 미리 지정해둔 작업을 처리하는 방식을 뜻한다.   
구체적으로 말하자면 이벤트 리스너에 등록해둔 콜백 함수를 실행하는 방식이다. 이런 이벤트에 따라 호출되는 콜백함수를 관리하는 것이 이벤트 루프이다.   

Node.js를 크게 나눠보면 내장 라이브러리와 V8 엔진 그리고 libuv로 나눠진다.   
Node.js의 특성인 이벤트 기반, 논 블로킹 I/O 모델들은 모두 libuv 라이브러리에서 구현되는데 이벤트 루프는 여러 개의 페이즈 들을 갖고 있으며 해당 페이즈들은 각각 큐를 가지고 있다.   
이벤트 루프는 프로세스가 종료될 때까지 여러 페이즈들을 계속 순회하고 페이즈들은 각각의 큐들을 관리하며 각각의 큐는 FIFO 순서로 콜백 함수들을 처리한다.   

Input Output에 관련된 작업 등의 블로킹 작업들은 백그라운드에서 수행하고 이를 비동기 콜백 함수로 이벤트 루프에 전달하는 것으로 비동기I/O를 실행하게 된다.   
libuv는 OS 커널에서 어떤 비동기 작업들을 지원해주는지 알고 있기 때문에 작업 종류에 따라서 커널 혹은 스레드 풀로 분기하고, libuv의 스레드풀은 커널이 지원안하는 작업들을 수행하게 된다.   
또한 libuv 의 스레드 풀은 멀티 스레드로 이루어져 있는데, 예를 들어 파일 시스템은 libuv에서 처리되게 되고 스레드 풀도 마찬가지로 작업을 마친 후 이벤트 루프에 콜백 함수를 전달한다.   

