# null을 다루는 방법

### null safe 문법
null 값이 프로젝트 전방위적으로 퍼져있는 상태에서 null에러를 피하는 방법 중대표적으로 Optional chaining(?.)이 있다.
```javascript
const user = {
	name: "Tom",
	address: null
}
console.log(user?.address?.street) //address까지는 있지만 street가 없기 때문에 undefined가 출력된다.
```

Nullish coalescing(??)은 변수의 값이 undefined, null이면 정의한 값을 할당하는 문법이다.

```javascript
const input = null;
let value = input ?? "default"
console.log(value) // "default"
```

하지만 이런 방법들은 null을 피하는 방법이지 null을 다루는 방법이 아니다.

### null을 안전하게 다루기
#### 1.  사전 조건 검증
* 입구에서 막기. 가능하면 가장 처음 진입점에서 검증해야 한다.
* if문으로 체크해야할 대상이 많다면 도와주는 도구(라이브러리 등)를 사용한다.


사용자 입력 혹은 외부 API조회 등으로 직렬화/역직렬화가 필요한 계층에서는 데코레이터(어노테이션) 기반으로 사전검증하는 것도 좋은 방법이다.  
 
사전 조건 검증은 null이 침범하지 않는 영역을 확실하게 확보하여 주요 비즈니스 로직까지 null이 침범하지 않도록 하는 것을 의미한다. 

#### 2.  null을 최대한 반환하지 않는다.
메서드/함수의 인자로 전달되는 경우 메서드/함수 내부에서만 null을 사용하고 가능한 외부로 전달되지 않도록 한다.
* 반환 값이 꼭 있어야 한다면 null을 반환하지 말고 예외를 던진다.
* null 대신 유효한 반환값이 반환되어 이후 실행되는 로직에서 null로 인한 피해가 가지 않도록 한다.


예외로 인해 흐름이 종료되는 것이 아니라 다음 흐름으로 정상적으로 넘어가길 원하는 경우 null object 등을 이용한다.   
보통 ORM이 조회결과가 없을 때 빈 배열을 반환하는 경우가 이에 속한다.   
   
문자열의 경우 빈 문자열을 null object로 사용하면 된다. 단, 특정 의미를 가진 경우 null을 반환하는 것이 좋을 수 있다.   
주의할 점은 null object는 fail-fast를 못하게 한다. 더이상 흐름을 진행하면 안된다면 바로 예외를 발생시키는 것이 옳다.   

#### 3. 함수 파라미터, 함수 전달인자에서 null 최대한 피하기 
* 함수나 객체의 인자로 null을 전달하는 것을 피하고, 함수 파라미터(매개변수)는 nullable을 최대한 피한다.   
* 호출하는 쪽에서 인자로 null을 넣어도 된다고 느끼게 하면 안된다.   


null을 받지 않는 함수들의 모음을 최대한 늘려 null의 범위로 최소화 한다.

#### 4. 초기값과 실행값 구분
* 초기값을 설정하면 필드값 접근이 필요할 때마다 null체크를 할 필요가 없어지고 항상 유효한 상태를 보장하며 가독성이 향상된다.



값을 다뤄야 할 때는 항상 초기값을 명시적으로 구분해서 실행할때마다 값의 체크가 필요한 경우를 최대한 배제한다.
