# 데이터베이스 정리

## 왜 데이터베이스를 사용하는가? 
데이터를 저장하는 방법에는 in Memory, File I/O도 있지만 in Memory의 경우 프로그램이 갑자기 종료되거나 하는 만약의 사태에 대비할 수 없고, 데이터의 사용가능 여부가 프로그램에 의존한다.
File I/O는 파일이 커질수록 비효율적이게 되고 여러파일을 동시에 이용하는 등의 작업을 하기 힘들다.
데이터베이스는 데이터에 특화된 서버로 필터링 기능 외, File I/O방식으로 구현하기 힘든 여러 기능을 가진다.

## 데이터베이스의 종류
크게 RDB와 NoSQL로 나눌 수 있다. RDB는 관계형 데이터베이스로 데이터를 열과 행의 구조로 만들어진 테이블에 저장하고, 서로 다른 테이블에 저장된 데이터가 어떻게 관계되어 있는지 사전 정의된 관계를 통해 구성한다. 
여기서 관계란 테이블 간에 상호작용을 기반으로 설정된 여러 테이블 간의 논리적 연결을 말한다. 

NoSQL은 SQL을 사용할 수 있는 데이터베이스와 달리 데이터의 구조가 고정되어 있지 않은 데이터베이스이다. 테이블 구조가 아니라 다른 방법으로 데이터를 저장하는데, 문서로 데이터를 저장하는 MongoDB나 key-value 쌍으로 데이터를 저장하는 redis 등이 있다.

일반적으로 데이터베이스의 ACID 성질을 준수해야 하는 경우나 데이터의 구조가 일관될 경우 관계형 데이터베이스를 사용하고, 데이터구조가 거의 없거나 아예 없는 데이터를 저장하거나 클라우드 컴퓨팅 활용, 데이터구조의 잦은 변화가 있을 경우에는 NoSQL을 사용한다.

#### 관계형 데이터베이스의 관계
* 일대일
* 일대다
* 다대다

## DBMS
DBMS란 데이터베이스 관리 시스템을 말한다. 사용자가 데이터에 관한 정보를 빠르고 효율적으로 구성, 검색할 수 있도록 하는 응용프로그램 모음이다.
DBMS을 사용하면 데이터를 구조적으로 저장하여 중복성을 제어할 수 있고, 데이터베이스의 접근에 대한 권한설정, 필요한 경우 데이터의 백업 및 복구를 제공한다.

관계형 데이터베이스에 해당하는 DBMS는 RDBMS라고 하며, SQL을 사용하여 관계형 데이터베이스에서 쉽게 데이터에 접근할 수 있다.

## SQL
SQL문은 Structured Query Language의 약자이고, 데이터베이스용 프로그래밍언어를 뜻한다.

SQL문은 기본적으로 DDL, DML, DCL의 세 범주로 나뉜다.

* DDL - 데이터 정의 언어. 데이터를 보유하는 구조를 정의하는데 사용된다. 이 명령은 자동 커밋되기 때문에 수행된 사항이 영구적으로 저장된다.

* DML - 데이터 조작 언어. 데이터베이스의 데이터를 조작하는데 사용된다. 이 명령은 자동 커밋되지 않으며 롤백할 수 있다.

* DCL - 데이터 제어 언어. 데이터베이스에서 데이터의 가시성을 제어하는데 사용된다. 권한 부여와 박탈등이 가능하다.

## 트랜잭션
데이터베이스의 일관성 있는 상태를 다른 것으로 변경하는 작업 순서를 말한다. 트랜잭션은 여러개의 작업순서를 하나로 묶은 것으로 다 성공하거나, 하나라도 실패하면 트랜잭션 자체가 실패하여 변경사항이 반영되지 않는다. 

트랜잭션의 안전성을 보장하기 위해 필요한 성질이 ACID이고, 이를 통해 발생할 수 있는 예외적인 상황을 줄이고 데이터베이스의 무결성을 보호할 수 있다.

## ACID
* A - Atomicity 원자성. 트랜잭션의 연산이 모두 성공하거나 모두 실패하는 성질이다. 작업이 모두 반영되거나 반대로 모두 반영되지 않아 결과를 예측 할 수 있어야 한다.

* C - Consistency 일관성. 트랜잭션 이전과 이후에 데이터베이스 상태는 이전과 같이 유효해야 한다. 데이터베이스의 제약과 규칙을 만족해야 한다.

* I - Isolation 독립성. 모든 트랜잭션은 다른 트랜잭션과 독립되어야 한다. 동시에 여러 트랜잭션이 수행되어도 트랜잭션이 연속으로 수행된 것과 결과가 같아야 한다. 트랜잭션이 완전히 완료되기 전에는 다른 트랜잭션이 수행 결과를 참조 할 수 없다.

* D - Durability 지속성. 트랜잭션이 성공적으로 수행되었으면 결과가 영구적으로 반영되어야 한다.

## 정규화와 비정규화
* 정규화 - 데이터 무결성을 유지하기 위해 잘 정의된 방식으로 테이블을 분할하여 데이터베이스에서 중복 데이터를 제거하는 프로세스이다. 즉, 관계형 데이터베이스에서 중복을 최소화 하기 위해 데이터베이스를 구조화하는 작업.

* 비정규화 - 복잡한 쿼리 속도를 높이고 성능을 향상시키기 위해 테이블에 중복 데이터를 추가하는 프로세스이다.

정규화는 데이터베이스 변경 시 이상 현상을 제거하고 구조 확장시 재디자인을 최소화 할 수 있지만, 릴레이션 분해로 인해 릴레이션 간의 연산이 많아져 응답시간이 느려질 수 있다.

## 인덱스
인덱스는 테이블에 대한 동작의 속도를 높여주는 자료구조를 말한다. 인덱스는 테이블 내의 1개 컬럼 또는 여러개의 컬럼을 이용하여 생성될 수 있다. 

데이터의 양이 많고 검색이 변경보다 빈번한 경우, 인덱스를 걸고자 하는 필드의 값이 다양한 값을 가지는 경우 인덱스를 사용한다.

그러나 인덱스 저장을 위한 별도의 공간이 필요하고 데이터 삽입, 삭제, 수정이 있을 경우 성능이 저하 된다.

## Unique 키
Unique 키는 유일성을 가지기 위해 설정해 놓는 키로 중복을 방지한다. Primary 키는 하나만 생성할 수 있지만 Unique 키는 여러개 생성이 가능하다.

Primary키는 null 값을 허용하지 않지만, Unique 키는 null 값을 허용한다.

## JOIN
두 개 이상의 테이블이나 데이터베이스를 연결하여 데이터를 검색하는 방법을 말한다.
* Inner Join - 2개 이상의 테이블에서 교집합만을 추출한다.
* Left Join - 2개 이상의 테이블에서 from에 해당하는 부분을 추출한다.
* Right Join - 2개 이상의 테이블에서 from과 join하는 테이블에 해당하는 부분을 추출한다.
* Outer Join - Full Join이라고도 한다. 2개 이상의 테이블에서 모든 테이블에 해당하는 부분을 추출한다.

## 교착상태
2개 이상의 트랜잭션이 특정 자원(테이블 또는 행)의 잠금을 획득한 채 다른 트랜잭션이 소유하고 있는 잠금을 요구할 경우 아무리 기다려도 상황이 바뀌지 않는 상태를 말한다.

예방하는 법은 정해진 순서로 테이블에 접근하고, SELECT ~ FOR UPDATE 의 사용을 피한다.

## DELETE과 TRUNCATE와 DROP의 차이
* DELETE - 연산을 실시 한 후 손실된 데이터를 검색하기 위해 COMMIT 및 ROLLBACK문을 수행 할 수 있다.
* TRUNCATE - 조작을 실시 한 후 손실된 데이터를 검색하기 위해 COMMIT 및 ROLLBACK문을 수행 할 수 없다.
* DROP - 기본키/외래키와 같은 키 또는 테이블을 삭제하는데 사용된다.

#### 테이블을 드롭(DROP)하는 것과 자르는 것(Truncate), 그리고 테이블 내 모든 레코드를 삭제(Delete)하는 것의 차이점
DELETE TABLE은 로그되는 작업이기 때문에 삭제되는 각 행은 트랜잭션 로그에 기록되고 이는 작업을 느리게 한다. TRUNCATE TABLE은 테이블 내 행들을 삭제하지만 삭제되는 각 행을 기록하지 않고 대신 테이블의 데이터베이스 할당 해제를 기록하여 작업이 빠르다. TRUNCATE는 롤백할 수 없다.
DROP TABLE은 테이블 전체, 공간, 객체를 삭제한다. 롤백할 수 없다.






