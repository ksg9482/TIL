# OCP_개방-폐쇄 원칙
## OCP(Open-Close Principle) 개요
개방-폐쇄 원칙이라는 말은 버트란트 마이어(Bertrand Meyer)가 만들었는데, 다음과 같다.

* 소프트웨어 개체(artifact)는 확장에는 열려있어야 하고, 변경에는 닫혀있어야 한다.

다시 말해, 소프트웨어 개체의 행위는 확장할 수 있어야 하지만 이 때 산출물을 변경해서는 안된다.

소프트웨어 아키텍처를 공부하는 **가장 근본적인 이유**가 바로 이 때문이다. 

만약 살짝 확장하는데 소프트웨어를 대폭 수정해야 한다면 그 소프트웨어 설계는 엄청난 실패를 맞닥뜨린 것이다. 

개방-폐쇄 원칙을 클래스와 모듈을 설계할 때 도움이 되는 원칙으로 알고있는 사람들이 많지만, 아키텍처 컴포넌트 수준에서 고려하면 훨씬 중요한 의미를 가진다.

### 사고실험
책임을 분리했다면 그 책임중 하나에서 변경이 발생하더라도 다른 책임은 변경되지 않도록 소스코드 의존성도 확실히 조직해야 한다.

또한 새로 조직화한 구조에서는 행위가 확장될 때 변경이 발생하지 않음을 보장해야 한다.

이런 목적을 달성하려면 처리과정을 **클래스 단위**로 분할하고, 이 클래스들을 **컴포넌트 단위**로 구분해야 한다.

* 예를 들어 Interactor, Controller, Presenter, View, Database로 이루어진 시스템 구조가 있다고 하자. 
  * Interactor는 업무규칙을 포함하고 있다. 즉, 가장 높은 수준의 정책을 포함하고 있기 때문에 우선순위가 가장 높고 다른 모든 것에서 발생한 변경에서 보호되어야 한다.
  * Interactor는 가장 개방-폐쇄 원칙을 잘 준수할 수 있는 곳에 위치하며, Controller, Presenter, View, Database에서 발생한 어떤 변경도 영향을 주어선 안된다. 
* Interactor입장에서 Controller는 부수적이지만, Presenter와 View보다는 중심적인 문제를 담당한다. 
* 마찬가지로 Presenter는 View보다는 중심적인 문제를 처리한다.

보호의 계층구조는 이런 **수준**이라는 개념을 바탕으로 생성된다. 
가장 높은 수준의 개념인 Interactor는 최고의 보호를 받는다. 가장 낮은 수준의 개념인 View는 거의 보호를 받지 못한다.

Controller는 Interactor보다 수준이 낮으나 Presenter나 View보다 수준이 높으니 중간 수준의 보호를 받는다.

이것이 아키텍처 수준에서 개방-폐쇄 원칙이 동작하는 방식이다. 

아키텍트는 기능이 **어떻게(what), 왜(why), 언제(when)** 발생하는지에 따라 기능을 분리하고 분리한 기능을 컴포넌트의 계층구조로 조직화 한다.

이와 같이 컴포넌트 계층구조를 조직화하면 저수준 컴포넌트에서 발생한 변경으로부터 고수준 컴포넌트를 보호 할 수 있다.

### 방향성 제어
컴포넌트를 이루는 구조 중 의존성의 방향을 제어하기 위한 목적을 가진 것도 있다. 

컴포넌트 간에 의존성이 원하지 않는 방향으로 가게 된다면 중간에 컴포넌트를 두어 의존성을 역전시켜야 한다.

### 정보 은닉
방향성을 제어하기 위한 컴포넌트가 있다면 다른 측면으로는 정보를 은닉하기 위한 인터페이스도 있다.

정보를 은닉하여 컴포넌트가 다른 컴포넌트의 내부에 대해 너무 많이 알지 못하도록 하는 것이다.

정보를 은닉하지 않으면 컴포넌트가 다른 컴포넌트에 추이종속성을 가지게 될 수도 있다.

* 추이종속성은 클래스A가 클래스B에 의존하고 클래스B는 클래스C에, 다시 클래스C는 클래스A에 의존하는 경우를 말한다.

* 만약 클래스 의존성이 이런식으로 순환하게 되면 모든 클래스가 서로 의존하게 되는 문제가 있다.

* 이는 '자신이 직접 사용하지 않는 요소에는 절대로 의존해서는 안된다'는 소프트웨어 원칙을 위반하게 된다.

가장 우선순위가 높은 컴포넌트는 우선순위가 낮은 컴포넌트의 변경에서 보호되어야 한다. 

반대로 우선순위가 낮은 컴포넌트라도 우선순위가 높은 컴포넌트의 변경에서 보호되기를 바란다. 이를 위해서 컴포넌트의 내부를 은닉하는 것이다.

### 결론
* 개방-폐쇄 원칙은 시스템 아키텍처를 떠받치는 원동력 중 하나다. 
* 개방-폐쇄 원칙의 목표는 시스템을 확장을 쉽게하는 동시에 변경으로 인해 시스템이 너무 많은 영향을 받지 않도록 하는데 있다.
* 이러한 목표를 달성하려면 시스템을 컴포넌트 단위로 분리해야 한다.
* 그리고 저수준 컴포넌트에서 발생한 변경으로부터 고수준 컴포넌트를 보호 할 수 있는 형태의 **의존성 계층구조**가 만들어지도록 해야 한다.
